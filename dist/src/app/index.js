"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const koa_1 = require("koa");
const cors = require("koa2-cors");
const bodyParser = require("koa-bodyparser");
const router_1 = require("../router");
const errHandler_1 = require("../handler/errHandler");
const resHandler_1 = require("../handler/resHandler");
const sessionHandler_1 = require("../handler/sessionHandler");
const server = require("koa-static");
const path = require("path");
const scheduleHandler_1 = require("../handler/scheduleHandler");
const db_1 = require("../db");
const app = new koa_1.default();
app.use(errHandler_1.default);
(0, db_1.default)().catch((e) => e);
(0, sessionHandler_1.default)(app);
(0, scheduleHandler_1.scheduleHandler)();
const serverPath = path.resolve(__dirname, '../static');
app.use(server(serverPath));
app.use(cors({ credentials: true, origin: (ctx) => ctx.header.origin }));
app.use(bodyParser());
(0, router_1.default)(app);
app.use(resHandler_1.default);
exports.default = app;
